{% extends 'base/base_template.html' %}
{% load static i18n %}

{% block Title %}
    {% trans "File Management" %}
{% endblock %}

{% block BodyClass %}
    has-rtl nk-body bg-white npc-default apps-only
{% endblock %}

{% block Style %}
    <style>
        .bg-1 {
            background: #ff7760 !important;
        }

        .bg-2 {
            background: #c06df4 !important;
        }

        .bg-3 {
            background: #4d9eff !important;
        }

        .bg-4 {
            background: #219a44 !important;
        }
    </style>
{% endblock %}

{% block Content %}
    <div class="nk-app-root profile-locked">
        <div class="nk-main">
            <div class="nk-wrap">

                {% include 'base/components/header.html' %}

                <div class="nk-content">
                    <div class="container wide-xl">
                        <div class="nk-content-inner">
                            <!-- .nk-aside -->
                            <div class="nk-content-body">
                                <div class="nk-content-wrap">
                                    <div class="nk-block-head nk-block-head-md">
                                        <div class="nk-block-between">
                                            <div class="nk-block-head-content">
                                                <h3 class="nk-block-title page-title">{% trans 'File Management' %}</h3>
                                            </div>
                                            <!-- .nk-block-head-content -->
                                            <div class="nk-block-head-content">
                                                <a href="{% url 'public:index' %}" class="back-to">
                                                    <span class="d-none d-sm-inline-block">{% trans 'Back to' %}</span>
                                                    &nbsp;
                                                    {% trans 'Dashboard' %}
                                                    <em class="icon ni ni-arrow-right"></em><span>
                                                </span>
                                                </a>
                                            </div>
                                            <!-- .nk-block-head-content -->
                                        </div>
                                        <!-- .nk-block-between -->
                                    </div>
                                    <!-- .nk-block-head -->
                                    <div class="nk-fmg nk-fmg-boxed">
                                        {% include 'comm/components/aside.html' %}
                                        <!-- .nk-fmg-aside -->
                                        <div class="nk-fmg-body">
                                            <div class="nk-fmg-body-head d-none d-lg-flex">
                                                <div class="nk-fmg-search">
                                                    <em class="icon ni ni-search"></em>
                                                    <form>
                                                        <input type="text" name="search"
                                                               class="form-control border-transparent form-focus-none"
                                                               value="{{ request.GET.search }}"
                                                               placeholder="{% trans 'Search files and folders by title or ...' %}"/>
                                                    </form>
                                                </div>
                                                <div class="nk-fmg-actions">
                                                    <ul class="nk-block-tools g-3">
                                                        <li>
                                                            <div class="dropdown">
                                                                <a href="#" class="btn btn-light"
                                                                   data-bs-toggle="dropdown"><em
                                                                        class="icon ni ni-plus"></em>
                                                                    <span>{% trans 'Create' %}</span></a>
                                                                <div class="dropdown-menu dropdown-menu-end">
                                                                    <ul class="link-list-opt no-bdr">
                                                                        <li>
                                                                            <a href="#file-upload"
                                                                               data-bs-toggle="modal"><em
                                                                                    class="icon ni ni-upload-cloud"></em><span>{% trans 'Upload File' %}</span></a>
                                                                        </li>
                                                                        <li>
                                                                            <a href="#folder-create"
                                                                               data-bs-toggle="modal"><em
                                                                                    class="icon ni ni-folder-plus"></em><span>{% trans 'Create Folder' %}</span></a>
                                                                        </li>
                                                                    </ul>
                                                                </div>
                                                            </div>
                                                        </li>
                                                        <li>
                                                            <a href="#file-upload" class="btn btn-primary"
                                                               data-bs-toggle="modal"><em
                                                                    class="icon ni ni-upload-cloud"></em>
                                                                <span>{% trans 'Upload' %}</span></a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                            <div class="nk-fmg-body-content">
                                                <div class="nk-block-head nk-block-head-sm">
                                                    <div class="nk-block-between position-relative">
                                                        <div class="nk-block-head-content">
                                                            <h3 class="nk-block-title page-title">{% trans 'Resources' %}</h3>
                                                        </div>
                                                        <div class="nk-block-head-content">
                                                            <ul class="nk-block-tools g-1">
                                                                <li class="d-lg-none">
                                                                    <a href="#"
                                                                       class="btn btn-trigger btn-icon search-toggle toggle-search"
                                                                       data-target="search"><em
                                                                            class="icon ni ni-search"></em></a>
                                                                </li>
                                                                <li class="d-lg-none">
                                                                    <div class="dropdown">
                                                                        <a href="#" class="btn btn-trigger btn-icon"
                                                                           data-bs-toggle="dropdown"><em
                                                                                class="icon ni ni-plus"></em></a>
                                                                        <div class="dropdown-menu dropdown-menu-end">
                                                                            <ul class="link-list-opt no-bdr">
                                                                                <li>
                                                                                    <a href="#file-upload"
                                                                                       data-bs-toggle="modal"><em
                                                                                            class="icon ni ni-upload-cloud"></em><span>{% trans 'Upload File' %}</span></a>
                                                                                </li>
                                                                                <li>
                                                                                    <a href="#folder-create"
                                                                                       data-bs-toggle="modal"><em
                                                                                            class="icon ni ni-folder-plus"></em><span>{% trans 'Create Folder' %}</span></a>
                                                                                </li>
                                                                            </ul>
                                                                        </div>
                                                                    </div>
                                                                </li>
                                                                <li class="d-lg-none me-n1">
                                                                    <a href="#" class="btn btn-trigger btn-icon toggle"
                                                                       data-target="files-aside"><em
                                                                            class="icon ni ni-menu-alt-r"></em></a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="search-wrap px-2 d-lg-none" data-search="search">
                                                            <div class="search-content">
                                                                <a href="#"
                                                                   class="search-back btn btn-icon toggle-search"
                                                                   data-target="search"><em
                                                                        class="icon ni ni-arrow-left"></em></a>
                                                                <form>
                                                                    <input type="text" name="search"
                                                                           class="form-control border-transparent form-focus-none"
                                                                           value="{{ request.GET.search }}"
                                                                           placeholder="{% trans 'Search files and folders by title or ...' %}"/>
                                                                </form>
                                                                <button class="search-submit btn btn-icon"><em
                                                                        class="icon ni ni-search"></em></button>
                                                            </div>
                                                        </div>
                                                        <!-- .search-wrap -->
                                                    </div>
                                                </div>
                                                {% if resources_pinned %}
                                                    <div class="nk-fmg-quick-list nk-block">
                                                        <div class="nk-block-head-xs">
                                                            <div class="nk-block-between g-2">
                                                                <div class="nk-block-head-content">
                                                                    <h6 class="nk-block-title title text-warning">
                                                                        {% trans 'Pinned' %}
                                                                        <em class="icon ni ni-star"></em>
                                                                    </h6>
                                                                </div>
                                                                <div class="nk-block-head-content">
                                                                    <a href="#"
                                                                       class="link link-primary toggle-opt active"
                                                                       data-target="quick-access">
                                                                        <div class="inactive-text">{% trans 'Show' %}</div>
                                                                        <div class="active-text">{% trans 'Hide' %}</div>
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- .nk-block-head -->
                                                        <div class="toggle-expand-content expanded" id="pinned"
                                                             data-content="quick-access">
                                                            <div class="nk-files nk-files-view-grid">
                                                                <div class="nk-files-list">
                                                                    {% for resource in resources_pinned %}
                                                                        <div class="nk-file-item nk-file">
                                                                            <div class="nk-file-info">
                                                                                <a href="{{ resource.get_absolute_url }}"
                                                                                   class="nk-file-link">
                                                                                    <div class="nk-file-title">
                                                                                        <div class="nk-file-icon">
                                                                                        <span class="nk-file-icon-type icon-by-extension"
                                                                                              extension="{{ resource.extension }}"></span>
                                                                                        </div>
                                                                                        <div class="nk-file-name">
                                                                                            <div class="nk-file-name-text">
                                                                                                <span class="title">{{ resource.name|truncatechars:'40' }}</span>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </a>
                                                                            </div>
                                                                            <div class="nk-file-actions">
                                                                                <a href="{% url 'communication:resource__pin_change_state' pk=resource.id %}"
                                                                                   class="btn btn-sm btn-icon btn-trigger"><em
                                                                                        class="icon ni ni-star-fill text-warning"></em></a>
                                                                            </div>
                                                                        </div>
                                                                    {% endfor %}

                                                                </div>
                                                            </div>
                                                            <!-- .nk-files -->
                                                        </div>
                                                    </div>
                                                {% endif %}
                                                <div class="nk-fmg-listing nk-block-lg">
                                                    <div class="nk-block-head-xs">
                                                        <div class="nk-block-between g-2">
                                                            <div class="nk-block-head-content">
                                                                <h6 class="nk-block-title title">{% trans 'Files/Folders' %}</h6>
                                                            </div>
                                                            <div class="nk-block-head-content">
                                                                <ul class="nk-block-tools g-2 nav gx-3 column-gap-1">
                                                                    <li class="badge badge-dim bg-success">
                                                                        <span class="fs-14px price-el">{{ resource_files.count|default:'0' }}</span>
                                                                        <em class="icon ni ni-files"></em>
                                                                    </li>
                                                                    <li class="badge badge-dim bg-success">
                                                                        <span class="fs-14px price-el">{{ resource_folders.count|default:'0' }}</span>
                                                                        <em class="icon ni ni-folder"></em>
                                                                    </li>
                                                                </ul>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- .nk-block-head -->
                                                    <div class="tab-content mt-1">
                                                        <div class="tab-pane active" id="file-list-view">
                                                            {% if resources %}
                                                                <div class="nk-files nk-files-view-list">
                                                                    <div class="nk-files-head">
                                                                        <div class="nk-file-item">
                                                                            <div class="nk-file-info">
                                                                                {% trans 'Name' %}
                                                                            </div>
                                                                            <div class="nk-file-meta">
                                                                                {% trans 'Last opened' %}
                                                                            </div>
                                                                            <div class="nk-file-members">
                                                                                <div class="tb-head">{% trans 'Shared With' %}</div>
                                                                            </div>
                                                                            <div class="nk-file-actions d-none">
                                                                                <div class="dropdown">
                                                                                    <a href=""
                                                                                       class="dropdown-toggle btn btn-sm btn-icon btn-trigger"
                                                                                       data-bs-toggle="dropdown"><em
                                                                                            class="icon ni ni-more-h"></em></a>
                                                                                    <div class="dropdown-menu dropdown-menu-end">
                                                                                        <ul class="link-list-opt no-bdr">
                                                                                            <li>
                                                                                                <a href="#file-share"
                                                                                                   data-bs-toggle="modal"><em
                                                                                                        class="icon ni ni-share"></em><span>به اشتراک گذاری</span></a>
                                                                                            </li>
                                                                                            <li>
                                                                                                <a href="#file-copy"
                                                                                                   data-bs-toggle="modal"><em
                                                                                                        class="icon ni ni-copy"></em><span>کپی</span></a>
                                                                                            </li>
                                                                                            <li>
                                                                                                <a href="#file-move"
                                                                                                   data-bs-toggle="modal"><em
                                                                                                        class="icon ni ni-forward-arrow"></em><span>انتقال</span></a>
                                                                                            </li>
                                                                                            <li>
                                                                                                <a href="#"
                                                                                                   class="file-dl-toast"><em
                                                                                                        class="icon ni ni-download"></em><span>دانلود</span></a>
                                                                                            </li>
                                                                                            <li>
                                                                                                <a href="#"><em
                                                                                                        class="icon ni ni-trash"></em><span>حذف</span></a>
                                                                                            </li>
                                                                                        </ul>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <!-- .nk-files-head -->
                                                                    <div class="nk-files-list">
                                                                        {% for resource in resources %}
                                                                            <!-- .nk-file -->
                                                                            <div class="nk-file-item nk-file">
                                                                                <div class="nk-file-info">
                                                                                    <div class="nk-file-title">
                                                                                        <div class="custom-control custom-control-sm custom-checkbox notext">
                                                                                            <input type="checkbox"
                                                                                                   class="custom-control-input"
                                                                                                   id="file-check-n3"/>
                                                                                            <label class="custom-control-label"
                                                                                                   for="file-check-n3"></label>
                                                                                        </div>
                                                                                        <div class="nk-file-icon">
                                                                                        <span class="nk-file-icon-type icon-by-extension"
                                                                                              extension="{{ resource.extension }}">

                                                                                        </span>
                                                                                        </div>
                                                                                        <div class="nk-file-name">
                                                                                            <div class="nk-file-name-text">
                                                                                                <a href="{{ resource.get_absolute_url }}"
                                                                                                   class="title">
                                                                                                    {{ resource.name|truncatechars:'40' }}
                                                                                                </a>
                                                                                                <a class="p-1 fs-19px"
                                                                                                   href="{% url 'communication:resource__pin_change_state' pk=resource.id %}">
                                                                                                    {% if resource.id in resources_pinned_ids %}
                                                                                                        <em class="icon ni ni-star-fill text-warning"></em>
                                                                                                    {% else %}
                                                                                                        <em class="icon ni ni-star text-warning"></em>
                                                                                                    {% endif %}
                                                                                                </a>
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                                <div class="nk-file-meta fs-13px">
                                                                                    {% with resource.last_opened as last_opened %}
                                                                                        {% if last_opened %}
                                                                                            <div class="tb-lead">
                                                                                                {{ last_opened.date }}
                                                                                            </div>
                                                                                            <div class="tb-sub">
                                                                                                {% if last_opened.user == request.user %}
                                                                                                    {% trans 'You' %}
                                                                                                {% else %}
                                                                                                    {{ last_opened.user.get_full_name }}
                                                                                                {% endif %}
                                                                                            </div>
                                                                                        {% else %}
                                                                                            <span class="text-purple">{% trans 'Not Yet Opened.' %}</span>
                                                                                        {% endif %}
                                                                                    {% endwith %}
                                                                                </div>
                                                                                <div class="nk-file-members">
                                                                                    <div class="user-avatar-group">
                                                                                        {% with resource.shared_with.all as shared_with %}
                                                                                            {% for user in shared_with|slice:':4' %}
                                                                                                <div class="user-avatar xs bg-{{ forloop.counter }}">
                                                                                                    <span title="{{ user.get_full_name }}"
                                                                                                          data-bs-placement="bottom"
                                                                                                          data-bs-toggle="tooltip">{{ user.first_name.0 }} {{ user.last_name.0 }}</span>
                                                                                                </div>
                                                                                            {% endfor %}
                                                                                            {% if shared_with.count > 4 %}
                                                                                                <div class="user-avatar xs bg-light">
                                                                                                <span>
                                                                                                    {% if shared_with.count|add:'-4' %}
                                                                                                        {{ shared_with.count|add:'-4' }}
                                                                                                    {% endif %}
                                                                                                    +
                                                                                                </span>
                                                                                                </div>
                                                                                            {% endif %}
                                                                                        {% endwith %}
                                                                                    </div>
                                                                                </div>
                                                                                <div class="nk-file-actions">
                                                                                    <div class="dropdown">
                                                                                        <a href=""
                                                                                           class="dropdown-toggle btn btn-sm btn-icon btn-trigger"
                                                                                           data-bs-toggle="dropdown"><em
                                                                                                class="icon ni ni-more-h"></em></a>
                                                                                        <div class="dropdown-menu dropdown-menu-end">
                                                                                            <ul class="link-list-plain no-bdr">
                                                                                                <li>
                                                                                                    <a href="{{ resource.get_absolute_url }}"><em
                                                                                                            class="icon ni ni-eye"></em><span>{% trans 'Details' %}</span></a>
                                                                                                </li>
                                                                                                <li>
                                                                                                    <a href="#"
                                                                                                       style="cursor: not-allowed;opacity: .4"
                                                                                                       data-bs-toggle="modal"><em
                                                                                                            class="icon ni ni-share"></em><span>{% trans 'Share' %}</span></a>
                                                                                                </li>
                                                                                                <li>
                                                                                                    <a href="#"
                                                                                                       style="cursor: not-allowed;opacity: .4"
                                                                                                       data-bs-toggle="modal"><em
                                                                                                            class="icon ni ni-forward-arrow"></em><span>{% trans 'Move' %}</span></a>
                                                                                                </li>
                                                                                                <li>
                                                                                                    <a href="#"
                                                                                                       style="cursor: not-allowed;opacity: .4"
                                                                                                       class="file-dl-toast"><em
                                                                                                            class="icon ni ni-download"></em><span>{% trans 'Download' %}</span></a>
                                                                                                </li>
                                                                                            </ul>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        {% endfor %}
                                                                    </div>
                                                                </div>
                                                            {% else %}
                                                                {% if request.GET.search %}
                                                                    <div class="text-center mt-4">
                                                                        <span class="nk-file-icon-type d-block"
                                                                              style="width: 150px">
                                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                                             xmlns:xlink="http://www.w3.org/1999/xlink"
                                                                             version="1.1" id="Layer_1" x="0px" y="0px"
                                                                             viewBox="0 0 42 45"
                                                                             style="enable-background:new 0 0 42 45;"
                                                                             xml:space="preserve">
                                                                                <style type="text/css">
                                                                                    .pcc {
                                                                                        clip-path: url(#SVGID_2_);
                                                                                        fill: #E5A337;
                                                                                    }
                                                                                </style>
                                                                                <g>
                                                                                    <defs>
                                                                                        <rect id="SVGID_1_" y="2.9"
                                                                                              width="42" height="39.2"/>
                                                                                    </defs>
                                                                                    <clipPath id="SVGID_2_">
                                                                                        <use xlink:href="#SVGID_1_"
                                                                                             style="overflow:visible;"/>
                                                                                    </clipPath>
                                                                                    <path class="pcc"
                                                                                          d="M40.1,23.4c-2.8-3.8-4.7-7.2-6.3-9.9l-3.1,3.1l-4.4-4.4L30.5,8c-2.4-3.3-5-5.1-10.4-5.1C9,2.9,0,11.4,0,23.4   c0,12,8.6,18.7,19.7,18.7C30.8,42.1,47.6,33.6,40.1,23.4 M12.1,37.7c-1.3,0-2.3-1.1-2.3-2.3c0-1.3,1.1-2.3,2.3-2.3   c1.3,0,2.3,1.1,2.3,2.3C14.4,36.6,13.4,37.7,12.1,37.7 M16,38.2c-0.6,0-1.1-0.5-1.1-1.1S15.4,36,16,36c0.6,0,1.1,0.5,1.1,1.1   S16.6,38.2,16,38.2 M21.3,34.9c-0.2,0.2-0.4,0.3-0.7,0.4c-0.3,0-0.5-0.1-0.7-0.3l-3-3l4.6-5c0.3-0.4,0.3-1-0.1-1.3   c-0.4-0.3-1-0.3-1.3,0.1l-4.5,4.9l-3.3-3.3l4.9-4.5c0.4-0.3,0.4-0.9,0.1-1.3c-0.3-0.4-0.9-0.4-1.3-0.1l-5,4.6l-3-3   c-0.2-0.2-0.3-0.4-0.3-0.7c0-0.3,0.1-0.5,0.4-0.7l9.4-7.3l11.2,11.2L21.3,34.9z M29.9,23.8L29.8,24L18.9,13.1l0.2-0.2   c1.7-1.3,4.2-1.2,5.7,0.4l4.8,4.8C31.1,19.6,31.3,22.1,29.9,23.8"/>
                                                                                </g>
                                                                            </svg>
                                                                    </span>
                                                                        <a class="btn btn-outline-warning mt-2 btn-lg"
                                                                           href="{% url 'communication:index' %}">
                                                                            {% trans 'Clear Search' %}
                                                                        </a>
                                                                    </div>
                                                                {% else %}
                                                                    <div class="text-center mx-auto col-12 p-2">
                                                                        <div class="nk-file-icon-type d-block mb-2"
                                                                             style="width: 150px">
                                                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                                                 viewBox="0 0 90 90">
                                                                                <rect x="15" y="5" width="56"
                                                                                      height="70" rx="6" ry="6"
                                                                                      fill="#e3e7fe" stroke="#6576ff"
                                                                                      stroke-linecap="round"
                                                                                      stroke-linejoin="round"
                                                                                      stroke-width="2"/>
                                                                                <path d="M69.88,85H30.12A6.06,6.06,0,0,1,24,79V21a6.06,6.06,0,0,1,6.12-6H59.66L76,30.47V79A6.06,6.06,0,0,1,69.88,85Z"
                                                                                      fill="#fff" stroke="#6576ff"
                                                                                      stroke-linecap="round"
                                                                                      stroke-linejoin="round"
                                                                                      stroke-width="2"/>
                                                                                <polyline points="60 16 60 31 75 31.07"
                                                                                          fill="none" stroke="#6576ff"
                                                                                          stroke-linecap="round"
                                                                                          stroke-linejoin="round"
                                                                                          stroke-width="2"/>
                                                                                <rect x="40" y="45" width="23"
                                                                                      height="19" fill="#e3e7fe"
                                                                                      stroke="#6576ff"
                                                                                      stroke-linecap="round"
                                                                                      stroke-linejoin="round"
                                                                                      stroke-width="2"/>
                                                                                <rect x="36" y="49" width="23"
                                                                                      height="19" fill="#fff"
                                                                                      stroke="#6576ff"
                                                                                      stroke-linecap="round"
                                                                                      stroke-linejoin="round"
                                                                                      stroke-width="2"/>
                                                                                <polyline
                                                                                        points="37 62.88 45.12 55.94 52.81 63.06 55.99 59.44 59 62.76"
                                                                                        fill="none" stroke="#6576ff"
                                                                                        stroke-linecap="round"
                                                                                        stroke-linejoin="round"
                                                                                        stroke-width="2"/>
                                                                                <circle cx="52.11" cy="54.98" r="2.02"
                                                                                        fill="none" stroke="#6576ff"
                                                                                        stroke-linecap="round"
                                                                                        stroke-linejoin="round"
                                                                                        stroke-width="2"/>
                                                                            </svg>
                                                                        </div>
                                                                        <h4 class="text-warning">
                                                                            {% trans 'No files or folders have been added yet.' %}
                                                                        </h4>
                                                                        <div class="m-4">
                                                                            <a href="#file-upload"
                                                                               class="btn btn-primary btn-lg m-1"
                                                                               data-bs-toggle="modal"><em
                                                                                    class="icon ni ni-upload-cloud"></em>
                                                                                <span>{% trans 'Upload File' %}</span></a>
                                                                            <a href="#folder-create"
                                                                               class="btn btn-success btn-lg m-1"
                                                                               data-bs-toggle="modal"><em
                                                                                    class="icon ni ni-upload-cloud"></em>
                                                                                <span>{% trans 'Create Folder' %}</span></a>
                                                                        </div>
                                                                    </div>
                                                                {% endif %}
                                                            {% endif %}
                                                            <!-- .nk-files -->
                                                        </div>
                                                        <!-- .tab-pane -->
                                                    </div>
                                                    <!-- .tab-content -->
                                                </div>
                                                <!-- .nk-block -->
                                            </div>
                                            <!-- .nk-fmg-body-content -->
                                        </div>
                                        <!-- .nk-fmg-body -->
                                    </div>
                                    <!-- .nk-fmg -->
                                </div>
                                <!-- footer @s -->
                                {% include 'base/components/footer.html' %}
                                <!-- footer @e -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% include 'comm/components/modals/folder-create.html' with users=users %}
    {% include 'comm/components/modals/upload-file.html' with uses=uses %}

{% endblock %}

{% block Script %}
    <script src="{% static 'js/file-management.js' %}"></script>
{% endblock %}