{% extends 'base/base_template.html' %}

{% load static %}
{% load i18n %}

{% block Title %}
    {% trans 'Settings' %}
{% endblock %}

{% block Style %}
    <style>
        .user-approver {
            border-bottom: 1px solid rgba(0, 0, 0, 0.125);
            margin-bottom: 15px;
            padding-bottom: 10px;
            font-size: 13px;
        }

        .dark-mode .user-approver {
            border-bottom: 1px solid #203247;
        }

        .user-approver:last-of-type {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .select-approvers > div {
            margin: 10px auto;
        }

    </style>
{% endblock %}

{% block BodyClass %}
    has-rtl nk-body bg-white npc-default has-aside
{% endblock %}

{% block Content %}
    <div class="nk-app-root">
        <!-- main @s -->
        <div class="nk-main">
            <!-- sidebar @e -->
            <!-- wrap @s -->
            <div class="nk-wrap">
                <!-- main header @s -->
                {% include 'base/components/header.html' %}
                <!-- main header @e -->
                <!-- content @s -->
                <div class="nk-content">
                    <div class="container wide-xl">
                        <div class="nk-content-inner">
                            <!-- sidebar @s -->
                            {% include 'base/components/menu.html' %}
                            <div class="nk-content-body">
                                <div class="nk-block">
                                    <div class="card">
                                        <div class="card-aside-wrap tab-content">

                                            <div class="card-inner card-inner-lg tab-pane d-none"
                                                 id="company-management">
                                                <div class="nk-block-head nk-block-head-lg">
                                                    <div class="nk-block-between">
                                                        <div class="nk-block-head-content">
                                                            <h4 class="nk-block-title">{% trans 'Company Management' %}</h4>
                                                            <div class="nk-block-des">
                                                                <p>
                                                                    {% trans 'You can manage your company here.' %}
                                                                </p>
                                                            </div>
                                                        </div>
                                                        <div class="nk-block-head-content align-self-start d-lg-none">
                                                            <a href="#" class="toggle btn btn-icon btn-trigger mt-n1"
                                                               data-target="userAside"><em
                                                                    class="icon ni ni-menu-alt-r"></em></a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- .nk-block-head -->
                                                <div class="nk-block">
                                                    <div class="nk-data data-list">
                                                        <div class="data-head">
                                                            <h6>{% trans 'Base Information' %}</h6>
                                                        </div>
                                                        <div class="data-item" data-bs-toggle="modal"
                                                             data-bs-target="#company-edit">
                                                            <div class="data-col">
                                                                <span class="data-label">{% trans 'Name' %}</span>
                                                                <span class="data-value">{{ company.name }}</span>
                                                            </div>
                                                            <div class="data-col data-col-end">
                                                            <span class="data-more"><em
                                                                    class="icon ni ni-forward-ios"></em></span>
                                                            </div>
                                                        </div>
                                                        <!-- data-item -->
                                                        <div class="data-item" data-bs-toggle="modal"
                                                             data-bs-target="#company-edit">
                                                            <div class="data-col">
                                                                <span class="data-label">{% trans 'Scale' %}</span>
                                                                <span class="data-value">{{ company.get_scale_display }}</span>
                                                            </div>
                                                            <div class="data-col data-col-end">
                                                            <span class="data-more"><em
                                                                    class="icon ni ni-forward-ios"></em></span>
                                                            </div>
                                                        </div>
                                                        <!-- data-item -->
                                                    </div>
                                                    <!-- data-list -->
                                                    <div class="nk-data data-list">
                                                        <div class="data-head">
                                                            <h6>{% trans 'Language/TimeZone' %}</h6>
                                                        </div>
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">{% trans 'Language' %}</span>
                                                                <span class="data-value">
                                                                {{ LANGUAGE_CODE }}
                                                            </span>
                                                            </div>
                                                            <div class="data-col data-col-end">
                                                            </div>
                                                        </div>
                                                        <!-- data-item -->
                                                        <!-- data-item -->
                                                        <div class="data-item">
                                                            <div class="data-col">
                                                                <span class="data-label">{% trans 'TimeZone' %}</span>
                                                                <span class="data-value">
                                                                Iran(GMT+3:30)
                                                            </span>
                                                            </div>
                                                            <div class="data-col data-col-end"><a href="#"
                                                                                                  class="link link-primary">{% trans 'Change' %}</a>
                                                            </div>
                                                        </div>
                                                        <!-- data-item -->
                                                    </div>
                                                    <!-- data-list -->
                                                </div>
                                                <!-- .nk-block -->
                                            </div>

                                            <div class="card-inner card-inner-lg tab-pane active" id="approval-process">
                                                <div class="nk-block-head nk-block-head-lg">
                                                    <div class="nk-block-between">
                                                        <div class="nk-block-head-content">
                                                            <h4 class="nk-block-title">{% trans 'Approval Process' %}</h4>
                                                            <div class="nk-block-des">
                                                                <p>
                                                                    {% trans 'You can manage approval process groups' %}
                                                                </p>
                                                            </div>
                                                        </div>
                                                        <div class="nk-block-head-content align-self-start d-lg-none">
                                                            <a href="#" class="toggle btn btn-icon btn-trigger mt-n1"
                                                               data-target="userAside"><em
                                                                    class="icon ni ni-menu-alt-r"></em></a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- .nk-block-head -->
                                                <div class="nk-block">
                                                    <!-- data-list -->
                                                    <div class="nk-data data-list">
                                                        <div class="row">
                                                            <!-- .col -->
                                                            <div class="col-12 mb-4">
                                                                <button class="h-100 w-100 bg-white border border-dashed round-xl p-4 d-flex align-items-center justify-content-center"
                                                                        data-bs-toggle="modal"
                                                                        data-bs-target="#approval-process-group-create">
                                                                <span class="text-soft">
                                                                    {% trans 'Create Approval Process Group' %}
                                                                </span>
                                                                </button>
                                                            </div>
                                                            <!-- .col -->
                                                            {% for approval_process_group in approval_process_groups %}
                                                                <div class="col-12 text-center my-1"
                                                                     dir="ltr">
                                                                    <div class="card">
                                                                        <div class="card-inner">
                                                                            <div class="d-flex align-items-center justify-content-between">
                                                                                <div class="d-flex align-items-center">
                                                                                    <div class="ms-3">
                                                                                        <h5
                                                                                                data-bs-toggle="tooltip"
                                                                                                data-bs-placement="bottom"
                                                                                                title="{{ approval_process_group.title }}">
                                                                                            <b>{{ approval_process_group.title|truncatechars:'15' }}</b>
                                                                                        </h5>
                                                                                        <span class="sub-text">
                                                                                            {{ approval_process_group.description|truncatechars:'20' }}
                                                                                        </span>
                                                                                    </div>
                                                                                </div>
                                                                                <ul class="btn-toolbar justify-center gx-1 me-n1 flex-nowrap">
                                                                                    <li style="margin-right: 7.5px;padding-right: 15px;border-right: 1px dashed rgba(142,142,142,0.4);">
                                                                                        <a class="btn btn-icon"
                                                                                           style="cursor: default">
                                                                                            <em class="icon ni ni-users"></em>
                                                                                            <b class="fs-17px">{{ approval_process_group.users.count }}</b>
                                                                                        </a>
                                                                                        <a class="btn btn-icon"
                                                                                           style="cursor: default">
                                                                                            <em class="icon ni ni-user-check"></em>
                                                                                            <b class="fs-17px">{{ approval_process_group.get_approver_users.count }}</b>
                                                                                        </a>
                                                                                    </li>
                                                                                    <li>
                                                                                        <a data-bs-toggle="modal"
                                                                                           href="#approval-group-{{ approval_process_group.id }}-delete"
                                                                                           class="btn btn-trigger btn-icon"><em
                                                                                                class="icon ni ni-trash text-danger"></em></a>
                                                                                    </li>
                                                                                </ul>
                                                                            </div>
                                                                            <div class="text-start mt-2">
                                                                                {% for user in approval_process_group.users.all %}
                                                                                    <a href="{{ user.get_absolute_url }}"
                                                                                       class="badge badge-dim bg-success">
                                                                                        {{ user.get_full_name }}
                                                                                    </a>
                                                                                {% endfor %}
                                                                            </div>
                                                                            <div class="mt-1">
                                                                                <span class="text-start d-block p-2 title">{% trans 'Approvers' %}</span>
                                                                                <div class="card">

                                                                                    <div class="card-header row col-12 mx-auto">
                                                                                        <span class="col-7">{% trans 'User' %}</span>
                                                                                        <span class="col-5">{% trans 'Priority' %}</span>
                                                                                    </div>
                                                                                    <div class="card-body">
                                                                                        {% for user_approver in approval_process_group.get_approver_users %}
                                                                                            <div class="row user-approver">
                                                                                            <span class="col-7">
                                                                                                <a href="{{ user_approver.user.get_absolute_url }}">{{ user_approver.user.get_full_name }}</a>
                                                                                            </span>
                                                                                                <div class="col-5">
                                                                                                    <span class="badge badge-sm badge-dim bg-info">{{ user_approver.priority }}</span>
                                                                                                </div>
                                                                                            </div>
                                                                                        {% endfor %}
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            {% endfor %}
                                                        </div>
                                                        <!-- data-item -->
                                                    </div>
                                                    <!-- data-list -->
                                                </div>
                                                <!-- .nk-block -->
                                            </div>

                                            <div class="card-inner card-inner-lg tab-pane" id="yarmalli">
                                                <div class="nk-block-head nk-block-head-lg">
                                                    <div class="nk-block-between">
                                                        <div class="nk-block-head-content">
                                                            <h4 class="nk-block-title">
                                                                <span style="color: #2edf76">{% trans 'YarMalli ' %}</span>
                                                                {% trans 'Application Settings' %}
                                                            </h4>
                                                            <div class="nk-block-des">
                                                                <p>
                                                                    {% trans 'Here, you can manage the settings related to the Yarmali application.' %}
                                                                </p>
                                                            </div>
                                                            {% if not yarmalli_sdk_has_enabled %}
                                                                <p class="badge badge-dim bg-danger badge-md d-block"
                                                                   style="white-space: normal">
                                                                    {% blocktrans %}
                                                                        Please note that the YarMalli SDK is not
                                                                        installed.
                                                                        To use and connect to the YarMalli application,
                                                                        you must install the YarMalli SDK.
                                                                    {% endblocktrans %}
                                                                </p>
                                                                <div class="badge badge-dim bg-danger p-1 badge-md d-block text-decoration-underline">
                                                                    <p>{% trans 'Run bellow command in terminal to install sdk' %}</p>
                                                                    <pre class=" text-start m-0 p-0" style="white-space: normal">
                                                                         pip install yarmalli_sdk
                                                                    </pre>
                                                                </div>
                                                            {% endif %}
                                                        </div>
                                                        <div class="nk-block-head-content align-self-start d-lg-none">
                                                            <a href="#" class="toggle btn btn-icon btn-trigger mt-n1"
                                                               data-target="userAside"><em
                                                                    class="icon ni ni-menu-alt-r"></em></a>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- .nk-block-head -->
                                                <div class="nk-block">
                                                    <div class="nk-data data-list">
                                                        <div class="data-head">
                                                            <h6>{% trans 'API Settings' %}</h6>
                                                        </div>
                                                        <div class="data-item" data-bs-toggle="modal"
                                                             data-bs-target="#yarmalli-api-key-edit">
                                                            <div class="data-col">
                                                                <span class="data-label">{% trans 'API KEY' %}</span>
                                                                {% if yarmalli_settings.api_key %}
                                                                    <span class="data-value badge badge-dim bg-secondary">
                                                                        {{ yarmalli_settings.api_key|truncatechars:'20' }}
                                                                    </span>
                                                                {% endif %}
                                                            </div>
                                                            <div class="data-col data-col-end">
                                                                {% if yarmalli_settings.api_key %}
                                                                    <span class="data-more"><em
                                                                            class="icon ni ni-forward-ios"></em></span>
                                                                {% else %}
                                                                    <a href="#" class="link">{% trans 'SET' %}</a>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                        <!-- data-item -->
                                                    </div>
                                                    <!-- data-list -->
                                                    <div class="nk-data data-list">
                                                        <div class="data-head">
                                                            <h6>{% trans 'Journal Author' %}</h6>
                                                        </div>
                                                        <div class="data-item" data-bs-toggle="modal"
                                                             data-bs-target="#yarmalli-journal-author-edit">
                                                            <div class="data-col">
                                                                <span class="data-label">{% trans 'User' %}</span>
                                                                {% if yarmalli_settings.journal_author %}
                                                                    <span class="data-value badge badge-dim bg-secondary">
                                                                        {{ yarmalli_settings.get_journal_author_name|truncatechars:'20' }}
                                                                    </span>
                                                                {% endif %}
                                                            </div>
                                                            <div class="data-col data-col-end">
                                                                {% if yarmalli_settings.api_key %}
                                                                    <span class="data-more"><em
                                                                            class="icon ni ni-forward-ios"></em></span>
                                                                {% else %}
                                                                    <a href="#" class="link">{% trans 'SET' %}</a>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                        <!-- data-item -->
                                                    </div>
                                                    <!-- data-list -->
                                                </div>
                                                <!-- .nk-block -->
                                            </div>

                                            <div
                                                    class="card-aside card-aside-left user-aside toggle-slide toggle-slide-left toggle-break-lg"
                                                    data-toggle-body="true"
                                                    data-content="userAside"
                                                    data-toggle-screen="lg"
                                                    data-toggle-overlay="true"
                                            >
                                                <div class="card-inner-group" data-simplebar>
                                                    <div class="card-inner">
                                                        <div class="user-card">
                                                            <div class="user-avatar bg-primary">
                                                            <span>
                                                                {{ user.first_name|slice:':1' }}
                                                                {{ user.last_name|slice:':1' }}
                                                            </span>
                                                            </div>
                                                            <div class="user-info">
                                                                <span class="lead-text">{{ user.get_full_name }}</span>
                                                                <span class="sub-text">{{ user.email }}</span>
                                                            </div>
                                                            <div class="user-action">
                                                                <div class="dropdown">
                                                                    <a class="btn btn-icon btn-trigger me-n2"
                                                                       data-bs-toggle="dropdown" href="#"><em
                                                                            class="icon ni ni-more-v"></em></a>
                                                                    <div class="dropdown-menu dropdown-menu-end">
                                                                        <ul class="link-list-opt no-bdr">
                                                                            <li>
                                                                                <a href="{% url 'account:user_profile' %}"><em
                                                                                        class="icon ni ni-edit-fill"></em><span>
                                                                                {% trans 'Edit Profile' %}
                                                                            </span></a>
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <!-- .user-card -->
                                                    </div>
                                                    <!-- .card-inner -->
                                                    <div class="card-inner d-none">
                                                        <div class="user-account-info py-0">
                                                            <h6 class="-alt">{% trans 'Company' %}</h6>
                                                            <div class="text-info fs-2">
                                                                {{ company.name }}
                                                            </div>
                                                            <div class="fs-14px">
                                                                {{ fiscal_year.name }}
                                                                {% if fiscal_year.is_active %}
                                                                    &nbsp;
                                                                    <span class="badge bg-success badge-dim rounded-pill">{% trans 'Active' %}</span>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- .card-inner -->
                                                    <div class="card-inner p-0">
                                                        <ul class="nav link-list-menu m-0">
                                                            <li class="nav-item d-none">
                                                                <a class="" data-bs-toggle="tab"
                                                                   href="#company-management">
                                                                    <em class="icon ni ni-building"></em>
                                                                    <span>{% trans 'Company/General' %}</span>
                                                                </a>
                                                            </li>
                                                            <li class="nav-item">
                                                                <a data-bs-toggle="tab" class="active"
                                                                   href="#approval-process">
                                                                    <em class="icon ni ni-check-circle-cut"></em>
                                                                    <span>{% trans 'Approval Process' %}</span>
                                                                </a>
                                                            </li>
                                                            <li class="nav-item">
                                                                <a data-bs-toggle="tab"
                                                                   href="#yarmalli">
                                                                    <em class="icon ni ni-code"></em>
                                                                    <span>
                                                                        <span>{% trans 'YarMalli' %}</span>
                                                                        {% trans 'Application Settings' %}
                                                                    </span>
                                                                </a>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                    <!-- .card-inner -->
                                                </div>
                                                <!-- .card-inner-group -->
                                            </div>
                                            <!-- card-aside -->
                                        </div>
                                        <!-- .card-aside-wrap -->
                                    </div>
                                    <!-- .card -->
                                </div>
                                <!-- .nk-block -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- content @e -->
                <!-- footer @s -->
                {% include 'base/components/footer.html' %}
                <!-- footer @e -->
            </div>
            <!-- wrap @e -->
        </div>
        <!-- main @e -->
        <div class="modal fade" role="dialog" id="yarmalli-api-key-edit">
            <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                <div class="modal-content">
                    <a href="#" class="close" data-bs-dismiss="modal"><em class="icon ni ni-cross-sm"></em></a>
                    <div class="modal-body ">
                        <h5 class="title">{% trans 'API Settings' %}</h5>
                        <!-- .nav-tabs -->

                        <form action="{% url 'public:yarmalli_settings__api_key__manage' %}" method="post"
                              class="form-validate is-alter">
                            {% csrf_token %}
                            <div class="row gy-4 mt-4">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label" for="api_key">{% trans 'API KEY' %}</label>
                                        <input type="text" class="form-control" id="api_key" name="api_key"
                                               value="{{ yarmalli_settings.api_key }}"
                                               placeholder="{% trans 'API KEY' %}"/>
                                    </div>
                                </div>
                                <div class="col-12 mt-5">
                                    <ul class="align-center flex-wrap flex-sm-nowrap gx-4 gy-2">
                                        <li>
                                            <button data-bs-dismiss="modal" class="btn btn-lg btn-primary">
                                                {% trans 'Update' %}
                                            </button>
                                        </li>
                                        <li>
                                            <a href="#" data-bs-dismiss="modal"
                                               class="link link-light">{% trans 'Cancel' %}</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </form>

                        <!-- .tab-content -->
                    </div>
                    <!-- .modal-body -->
                </div>
                <!-- .modal-content -->
            </div>
            <!-- .modal-dialog -->
        </div>

        <div class="modal fade" role="dialog" id="fiscal-create">
            <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                <div class="modal-content">
                    <a href="#" class="close" data-bs-dismiss="modal"><em class="icon ni ni-cross-sm"></em></a>
                    <div class="modal-body ">
                        <h5 class="title">{% trans 'Create Financial Year' %}</h5>
                        <!-- .nav-tabs -->

                        <form action="#" method="post"
                              class="form-validate is-alter">
                            {% csrf_token %}
                            <input type="hidden" name="is_default" value="true">
                            <div class="row gy-4 mt-4">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label" for="full-name">{% trans 'Name' %}</label>
                                        <input type="text" class="form-control" id="full-name" name="name"
                                               placeholder="{% trans 'Name' %}"/>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label" for="start_time">{% trans 'Start Time' %}</label>
                                        <input type="text" name="start_time" id="start_time" required
                                               class="form-control date-picker-alt"
                                               placeholder="{% trans 'Start Time' %}" readonly>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label" for="end_time">{% trans 'End Time' %}</label>
                                        <input type="text" name="end_time" id="end_time" required
                                               class="form-control date-picker-alt"
                                               placeholder="{% trans 'End Time' %}" readonly>
                                    </div>
                                </div>

                                <div class="col-12 mt-5">
                                    <ul class="align-center flex-wrap flex-sm-nowrap gx-4 gy-2">
                                        <li>
                                            <button data-bs-dismiss="modal" class="btn btn-lg btn-primary">
                                                {% trans 'Create' %}
                                            </button>
                                        </li>
                                        <li>
                                            <a href="#" data-bs-dismiss="modal"
                                               class="link link-light">{% trans 'Cancel' %}</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </form>

                        <!-- .tab-content -->
                    </div>
                    <!-- .modal-body -->
                </div>
                <!-- .modal-content -->
            </div>
            <!-- .modal-dialog -->
        </div>

        <div class="modal fade" role="dialog" id="approval-process-group-create">
            <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                <div class="modal-content">
                    <a href="#" class="close" data-bs-dismiss="modal">
                        <em class="icon ni ni-cross-sm"></em>
                    </a>
                    <div class="modal-body">
                        <h5 class="title">{% trans 'Create Approval Process Group' %}</h5>

                        <form action="{% url 'accounting:document__approval_process_group__create' %}" method="post"
                              class="form-validate is-alter">
                            {% csrf_token %}

                            <div class="row gy-4 mt-4">

                                <!-- Title -->
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label" for="title">
                                            {% trans 'Title' %}
                                        </label>
                                        <input type="text" class="form-control" id="title"
                                               name="title"
                                               placeholder="{% trans 'Enter Group Title' %}" required>
                                    </div>
                                </div>

                                <!-- Description -->
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="form-label" for="description">
                                            {% trans 'Description' %}
                                        </label>
                                        <textarea class="form-control" id="description"
                                                  name="description" rows="3"
                                                  placeholder="{% trans 'Enter Description' %}"></textarea>
                                    </div>
                                </div>
                                <!-- Users -->
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <div class="mb-1 d-flex align-center justify-content-lg-between">
                                            <label class="form-label">
                                                {% trans 'Users' %}(<small
                                                    class="form-text text-muted">{% trans 'Users who follow this group process.' %}<b
                                                    class="text-warning">{% trans 'The selected user is unique. It cannot be used in other groups.' %}</b></small>)
                                            </label>
                                        </div>
                                        <div class="select-users">
                                            <div>
                                                <div class="form-control-wrap">
                                                    <select name="users" multiple
                                                            class="form-control form-select js-select2 d-inline-block"
                                                            data-search="on">
                                                        <option value="">{% trans 'Select Users' %}</option>
                                                        {% for user in users_approval_process_groups %}
                                                            <option value="{{ user.id }}">{{ user.get_full_name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Approvers -->
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <div class="mb-1 d-flex align-center justify-content-lg-between">
                                            <label class="form-label">
                                                {% trans 'Required Approvers' %}(<small
                                                    class="form-text text-muted">{% trans 'Select users who must approve this document. Leave empty for no approval required.' %}</small>)
                                            </label>
                                            <button type="button" id="btn-add-approver"
                                                    class="btn btn-outline-success">
                                                <em class="icon ni ni-plus"></em>
                                                <span class="d-none d-md-block">{% trans 'Add Approver' %}</span>
                                            </button>
                                        </div>
                                        <div class="select-approvers">
                                            <div>
                                                <div class="form-control-wrap">
                                                    <div class="input-group">
                                                        <div class="input-group-prepend col-2">
                                                            <input type="text"
                                                                   class="form-control text-center"
                                                                   name="priority"
                                                                   placeholder="{% trans 'Priority' %}"
                                                                   value="1">
                                                        </div>
                                                        <div class="col-10">
                                                            <select name="approvers"
                                                                    class="form-control form-select js-select2 d-inline-block"
                                                                    data-search="on">
                                                                <option value="">{% trans 'Select Approver' %}</option>
                                                                {% for user in users %}
                                                                    <option value="{{ user.id }}">{{ user.get_full_name }}</option>
                                                                {% endfor %}
                                                            </select>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Buttons -->
                                <div class="col-12 mt-5">
                                    <ul class="align-center flex-wrap flex-sm-nowrap gx-4 gy-2">
                                        <li>
                                            <button type="submit" class="btn btn-lg btn-primary">
                                                {% trans 'Create' %}
                                            </button>
                                        </li>
                                        <li>
                                            <a href="#" data-bs-dismiss="modal"
                                               class="link link-light">{% trans 'Cancel' %}</a>
                                        </li>
                                    </ul>
                                </div>

                            </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>

    {% if perms.accounting.delete_documentapprovalprocessgroup %}

        {% for approval_process_group in approval_process_groups %}
            <div class="modal fade" tabindex="-1" id="approval-group-{{ approval_process_group.id }}-delete"
                 aria-modal="true" role="dialog">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body modal-body-lg text-center">
                            <div class="nk-modal">
                                <em class="nk-modal-icon icon icon-circle icon-circle-xxl ni ni-file bg-danger"></em>
                                <h4 class="nk-modal-title">{% trans 'Delete Approval Process Group' %}</h4>
                                <div class="nk-modal-text">
                                    <p class="bg-outline-danger">
                                        {% blocktrans with title=approval_process_group.title %}
                                            Are you sure you want to delete {{ title }}? It will be permanently removed.
                                        {% endblocktrans %}
                                    </p>
                                </div>
                                <div class="nk-modal-action mt-5">
                                    <a class="btn btn-lg btn-mw btn-light m-1"
                                       data-bs-dismiss="modal">{% trans 'Cancel' %}</a>
                                    <a href="{% url 'accounting:document__approval_process_group__delete' pk=approval_process_group.id %}"
                                       class="btn btn-lg btn-mw btn-danger m-1">{% trans 'Yes, Delete' %}</a>
                                </div>
                            </div>
                        </div>
                        <!-- .modal-body -->
                    </div>
                </div>
            </div>
        {% endfor %}

    {% endif %}

{% endblock %}


{% block Script %}
    <script>
        // Control Active Settings Tab
        function saveActiveSettingsTab(tab_name) {
            setCookie('active_settings_tab', tab_name, 20)
        }

        function loadActiveSettingsTab() {
            let tab = getCookie('active_settings_tab')
            if (!tab) {
                return null
            }
            document.querySelector(`[data-bs-toggle="tab"][href="${tab}"]`).click()
        }

        loadActiveSettingsTab()
        document.querySelectorAll('[data-bs-toggle="tab"]').forEach(function (el) {
            el.addEventListener('click', function (el) {
                saveActiveSettingsTab(this.getAttribute('href'))
            })
        })

    </script>
    <script>
        document.getElementById('btn-add-approver').addEventListener('click', function (el) {


            let cnt = document.querySelector('.select-approvers')
            let selector = document.createElement('div')
            selector.className = 'd-flex justify-content-between align-center text-center'

            function get_options() {

                let options = document.querySelector('select[name="approvers"]').querySelectorAll('option')

                let node = ``

                options.forEach(function (el) {

                    let value = el.value
                    let name = el.innerText

                    node += `
                        <option value="${value}">${name}</option>
                    `

                })
                return node

            }

            selector.innerHTML = `
                <div class="form-control-wrap col-10 col-md-11">
                    <div class="input-group">
                        <div class="input-group-prepend col-2">
                            <input type="text" required
                                   class="form-control text-center"
                                   name="priority"
                                   placeholder="${translate('Priority')}">
                        </div>
                        <div class="col-10">
                            <select name="approvers" required
                                    class="form-control form-select js-select2 d-inline-block"
                                    data-search="on">
                                <option value="">${translate('Select Approver')}</option>
                                ${get_options()}

                            </select>
                        </div>
                    </div>
                </div>
                <div class="col-2 col-md-1 text-center">
                    <button class="btn btn-outline-danger btn-delete-approver-select" type="button">
                        <em class="icon ni ni-trash"></em>
                    </button>
                </div>
            `

            cnt.appendChild(selector)
            setSelectorCustom(selector)
            setEventDeleteOnApproverSelect()
        })

        function setEventDeleteOnApproverSelect() {
            document.querySelectorAll('.btn-delete-approver-select').forEach(function (el) {
                el.addEventListener('click', function (el) {
                    this.parentElement.parentElement.remove()
                })
            })
        }

        function setSelectorCustom(selector) {
            selector = selector.querySelector('select[name="approvers"]')
            NioApp.Select2(selector);
        }

    </script>
{% endblock %}